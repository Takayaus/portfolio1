<div class="container">
  <div class="tra-wrapper">

    <div class="row justify-content-center">
      <div class="tra-top">
        <div class="col-md-3 col-xs-12 tra-left text-center">
          <%= image_tag(@trainer.image.url) %>
        </div>
        <div class="col-md-9 col-xs-12 tra-right">
            <h3 class="inline-block"><%= @trainer.name %></h3>
          <div class="tra-like">
            <% if current_user.already_liked?(@trainer) %>
              <%= link_to trainer_like_path(@trainer), method: :delete, remote: :true do %>
                <i class="fa fa-heart" aria-hidden="true" style="color: red;">
                  <%= @trainer.likes.count %> 
                </i>
              <% end %>
            <% else %>
              <%= link_to trainer_likes_path(@trainer), method: :post, remote: :true do %>
                <i class="fa fa-heart" aria-hidden="true" style="color: #C0C0C0;">
                  <%= @trainer.likes.count %> 
                </i>
              <% end %>
            <% end %>
          </div>
          <div class="tra-rate">
            <p id="star-ave">評価</p>
            <p class=>(<%= @trainer.comments.count %>件)</p>
          </div>
            <script>
              $('#star-ave').raty({
                size: 36,
                starOff:  '<%= asset_path('star-off.png') %>',
                starOn : '<%= asset_path('star-on.png') %>',
                starHalf: '<%= asset_path('star-half.png') %>',
                half: true,
                readOnly: true,
                score: <%= @trainer.comments.average(:rate).to_f.round(1) %>,
                });
            </script>
            <p><%= @trainer.title %></p>
        </div> <!--tra-right-->
      </div><!--tra-top-->
      <div class="tra-content">
        <% text = @trainer.content %>
        <%= markdown(text).html_safe %>
      </div>
    </div> <!--row-->

        <div class="tra-comment">
          <h5 class="text-center">利用者の声</h5>
          <% if @comments.present? %>
            <% @comments.each do |comment| %>
              <div class="row comment-">

                <div class="col-md-2 comment-icon">
                  <%= image_tag(comment.user.image_name.url) unless comment.user.blank?%>
                  <h6><%= comment.user.name unless comment.user.blank? %></h6>
                </div>

                <div class="col-md-10 comment-content">
                  <div id="star-rate-<%= comment.id %>">評価　</div>
                  <h5><%= comment.title %></h5>
                  <p><%= comment.content %></p>
                </div>

                  <% if user_signed_in? && comment.user == current_user %>
                    <div class="comment-li">
                      <p><%= link_to '削除', trainer_comment_path(@trainer, comment), method: :delete %></p>
                      <p>/</p>
                      <p><%= link_to '編集', edit_trainer_comment_path(@trainer, comment) %></p>
                    </div>
                  <% end %>

                  <div class="new-gyms-time">
                    <p><%= comment.created_at %></p>
                  </div>
                          <script>
                            $('#star-rate-<%= comment.id %>').raty({
                              size: 36,
                              starOff:  '<%= asset_path('star-off.png') %>',
                              starOn : '<%= asset_path('star-on.png') %>',
                              starHalf: '<%= asset_path('star-half.png') %>',
                              half: true,
                              readOnly: true,
                              score: <%= comment.rate %>,
                              });
                          </script>

              </div>
            <% end %>
          <% end %>

            <% if user_signed_in? %>

              <%= form_with(model: [@trainer, @comment], local: true, remote: true) do |f| %>
              <div class="form-group">
                <%= f.label :title, "タイトル" %>
                <%= f.text_area :title, class: "form-control", rows: 1 %>
              </div>

              <div class="form-group">
                <%= f.label :content, "内容" %>
                <%= f.text_area :content, class: "form-control", rows: 5 %>
              </div>

              <div class="form-group" id="star">
                <%= f.label :rate,'評価' %>
                <%= f.hidden_field :rate, id: :comment_star %>
              </div>

              <script>
                $('#star').raty({
                  size     : 36,
                  starOff:  '<%= asset_path('star-off.png') %>',
                  starOn : '<%= asset_path('star-on.png') %>',
                  starHalf: '<%= asset_path('star-half.png') %>',
                  scoreName: 'comment[rate]',
                  half: true,
                  });
              </script>

              <%= button_tag type: "submit", class: "btn btn-success float-right mt-1" do %>
                <i class="far fa-comments"></i> コメントする
              <% end %>

              <% end %>
            <% end %>
        </div> <!--tra-comment-->

  </div> <!-- tra-wrapper-->
</div> <!--container-->
<div class="container">
    <div class="gyms-contents">
        <aside class="gyms-side">
            <div class="gyms-ransack">
                <%= search_form_for @q do |f| %>
                    <%= f.label :name, "キーワード" %>
                    <%= f.search_field :name_or_title_or_content_or_address_or_categories_name_cont %>
                    <%= f.label :district_id_eq, "エリア" %>
                    <%= f.collection_select :district_id_eq, @districts, :id, :name, include_blank: true %>
                    <%= f.label :categories_id_in, "カテゴリー" %>
                    <%= f.collection_check_boxes :categories_id_in, @categories, :id, :name %>
                    <%= f.label :price, '月会費' %>
                    <%= f.number_field :price_gteq %>円以上〜
                    <%= f.number_field :price_lt %>円未満
                    <%= f.select( :sorts, { '並び替え': 'id desc', '料金の安い順': 'price asc', '料金の高い順': 'price desc', '古い順': 'updated_at asc', '新しい順': 'updated_at desc', '口コミの多い順': 'comments_count desc'}) %>
                    <%= f.submit "検索" %>
                <% end %>
            </div>
        </aside>

        <div class="gyms-items">
            <% @gyms.each do |gym|%>
                <div class="gyms-item">
                    <div class="gyms-title">
                        <h5><%= link_to gym.name, gym_path(gym) %> </h5>
                    </div>
                    <div class=gyms-box>
                        <div class="gyms-left">
                            <a href="/gyms/<%= gym.id %>"><%= image_tag (gym.image.url) %></a>
                        </div>
                        <div class="gyms-right">
                            <div class="gyms-star">
                                <p id="star-ave<%= gym.id %>">評価</p>
                                <p>(口コミ数<%= gym.comments.count %>)</p>
                            </div>
                                <script>
                                $('#star-ave<%= gym.id %>').raty({
                                size: 36,
                                starOff:  '<%= asset_path('star-off.png') %>',
                                starOn : '<%= asset_path('star-on.png') %>',
                                starHalf: '<%= asset_path('star-half.png') %>',
                                half: true,
                                readOnly: true,
                                score: <%= gym.comments.average(:rate).to_f.round(1) %>,
                                });
                                </script>
                            <% gym.gym_categories.each do |g| %>
                                <%= link_to g.category.name, gyms_path(q: {categories_id_in: g.category_id }), {class: "gyms-content"} %>
                            <%end%>
                            <p class="gyms-content"><%= gym.address %></p></br>
                            <p class="gyms-content">月会費：<%= gym.price %></p>
                            <h6><%= gym.title %></h6>
                            
                        </div>
                    </div>
                    <div class="gyms-button">
                        <i class="fa fa-phone" aria-hidden="true" style="color: #0080ff;" ></i> <%=gym.number%>
                        <a href="#" class="btn-flat-simple">
                        <i class="fa fa-caret-right"></i> HPで詳しく見る
                        </a>
                    </div>
                </div>
            <% end %>
            <%= paginate @gyms %>
        </div>
    </div>
</div>